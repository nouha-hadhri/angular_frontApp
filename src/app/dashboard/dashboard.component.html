<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Tableau de Bord</h1>
    <div style="display:flex;align-items:center;gap:12px">
      <button mat-raised-button color="accent" (click)="refreshDashboard()" [disabled]="loading">
        <mat-icon>refresh</mat-icon>
        Rafraîchir
      </button>
      <div *ngIf="loading">Chargement...</div>
      <div *ngIf="errorMessage" style="color:#b00020">{{ errorMessage }}</div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon membres">
          <mat-icon>people</mat-icon>
        </div>
        <div class="stat-info">
          <p class="stat-label">Membres</p>
          <p class="stat-value">{{ totalMembres }}</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon outils">
          <mat-icon>build</mat-icon>
        </div>
        <div class="stat-info">
          <p class="stat-label">Outils</p>
          <p class="stat-value">{{ totalOutils }}</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon evenements">
          <mat-icon>event</mat-icon>
        </div>
        <div class="stat-info">
          <p class="stat-label">Événements</p>
          <p class="stat-value">{{ totalEvenements }}</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon publications">
          <mat-icon>article</mat-icon>
        </div>
        <div class="stat-info">
          <p class="stat-label">Publications</p>
          <p class="stat-value">{{ totalPublications }}</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Charts Grid -->
  <div class="charts-grid">
    <mat-card class="chart-card">
      <mat-card-title>Évolution des Membres</mat-card-title>
      <mat-card-content>
        <canvas
          baseChart
          [data]="membresChartData"
          [options]="membresChartOptions"
          type="bar"
        ></canvas>
      </mat-card-content>
    </mat-card>


    <mat-card class="chart-card">
      <mat-card-title>Événements par Semaine</mat-card-title>
      <mat-card-content>
        <canvas
          baseChart
          [data]="evenementsChartData"
          [options]="evenementsChartOptions"
          type="line"
        ></canvas>
      </mat-card-content>
    </mat-card>

    <!-- New: Age groups (pie) -->
    <mat-card class="chart-card">
      <mat-card-title>Répartition par Tranche d'Âge</mat-card-title>
      <mat-card-content>
        <canvas
          baseChart
          [data]="membresAgeGroupsData"
          [options]="membresAgeGroupsOptions"
          type="pie"
        ></canvas>
      </mat-card-content>
    </mat-card>


    <!-- New: Combined stacked monthly chart -->
    <mat-card class="chart-card">
      <mat-card-title>Membres vs Publications (Mensuel)</mat-card-title>
      <mat-card-content>
        <canvas
          baseChart
          [data]="combinedMonthlyData"
          [options]="combinedMonthlyOptions"
          type="bar"
        ></canvas>
      </mat-card-content>
    </mat-card>
  </div>
</div>
